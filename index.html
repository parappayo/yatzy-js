<!DOCTYPE html>
<meta charset="utf-8"/>
<html>

<head>
<title>Yatzy</title>
<style>

body {
	max-width: 38rem;
	padding: 2rem;
	margin: auto;
	font-family: "Helvetica", "Arial", sans-serif;
}

input {
	width: 3em;
}

.dice {
	font-size: x-large;
}

.score_help {
	font-size: small;
}
</style>
</head>

<body>
<script src="dice.js"></script>
<script>
"use strict";

var dice = createDice();

var most_recent_roll = [];
var is_die_held = {};

const scorecard_bonus_threshold = 63;
const scorecard_bonus_amount = 50;

const scorecard_upper_section_ids = [
	"yatzy_scorecard_ones",
	"yatzy_scorecard_twos",
	"yatzy_scorecard_threes",
	"yatzy_scorecard_fours",
	"yatzy_scorecard_fives",
	"yatzy_scorecard_sixes" ];

const scorecard_lower_section_ids = [
	"yatzy_scorecard_one_pair",
	"yatzy_scorecard_two_pair",
	"yatzy_scorecard_three_of_a_kind",
	"yatzy_scorecard_four_of_a_kind",
	"yatzy_scorecard_small_straight",
	"yatzy_scorecard_large_straight",
	"yatzy_scorecard_full_house",
	"yatzy_scorecard_chance",
	"yatzy_scorecard_yatzy" ];

const scorecard_max_values = {
	"yatzy_scorecard_ones" : 5,
	"yatzy_scorecard_twos" : 10,
	"yatzy_scorecard_threes" : 15,
	"yatzy_scorecard_fours" : 20,
	"yatzy_scorecard_fives" : 25,
	"yatzy_scorecard_sixes" : 30,
	"yatzy_scorecard_one_pair" : 12,
	"yatzy_scorecard_two_pair" : 24,
	"yatzy_scorecard_three_of_a_kind" : 18,
	"yatzy_scorecard_four_of_a_kind" : 32,
	"yatzy_scorecard_small_straight" : 30,
	"yatzy_scorecard_large_straight" : 30,
	"yatzy_scorecard_full_house" : 30,
	"yatzy_scorecard_chance" : 30,
	"yatzy_scorecard_yatzy" : 50
};

function upper_scorecard_eval(die_value)
{
	return (roll) => {
		return roll
			.map((value) => { return value == die_value ? die_value : 0; })
			.reduce((sum, value) => { return sum + value; });
	}
}

const scorecard_evals = {
	"yatzy_scorecard_ones" : upper_scorecard_eval(1),
	"yatzy_scorecard_twos" : upper_scorecard_eval(2),
	"yatzy_scorecard_threes" : upper_scorecard_eval(3),
	"yatzy_scorecard_fours" : upper_scorecard_eval(4),
	"yatzy_scorecard_fives" : upper_scorecard_eval(5),
	"yatzy_scorecard_sixes" : upper_scorecard_eval(6),
	"yatzy_scorecard_one_pair" : (roll) => { return 0; },
	"yatzy_scorecard_two_pair" : (roll) => { return 0; },
	"yatzy_scorecard_three_of_a_kind" : (roll) => { return 0; },
	"yatzy_scorecard_four_of_a_kind" : (roll) => { return 0; },
	"yatzy_scorecard_small_straight" : (roll) => { return 0; },
	"yatzy_scorecard_large_straight" : (roll) => { return 0; },
	"yatzy_scorecard_full_house" : (roll) => { return 0; },
	"yatzy_scorecard_chance" : (roll) => { return 0; },
	"yatzy_scorecard_yatzy" : (roll) => { return 0; }
};

function validate_scorecard_element(element_id)
{
	var element = document.getElementById(element_id);
	var elementMax = scorecard_max_values[element_id];
	var value = parseInt(element.value);
	value = isNaN(value) ? 0 : value;
	value = Math.max(0, Math.min(elementMax, value));
	element.value = value;
}

function validate_scorecard()
{
	scorecard_upper_section_ids.forEach((element_id) => { validate_scorecard_element(element_id); });
	scorecard_lower_section_ids.forEach((element_id) => { validate_scorecard_element(element_id); });
}

function sum_element_int_values(element_id_arr)
{
	return element_id_arr
		.map((element_id) => {
			var element = document.getElementById(element_id);
			var result = element ? parseInt(element.value) : 0;
			return isNaN(result) ? 0 : result;
		})
		.reduce((sum, value) => { return sum + value; });
}

function update_scorecard_totals()
{
	validate_scorecard();

	var upper_sum_input = document.getElementById('yatzy_scorecard_upper_sum');
	upper_sum_input.value = sum_element_int_values(scorecard_upper_section_ids);

	var lower_sum_input = document.getElementById('yatzy_scorecard_lower_sum');
	lower_sum_input.value = sum_element_int_values(scorecard_lower_section_ids);

	var bonus_input = document.getElementById('yatzy_scorecard_bonus');
	bonus_input.value = upper_sum_input.value >= scorecard_bonus_threshold ? scorecard_bonus_amount : 0;

	var total_input = document.getElementById('yatzy_scorecard_total');
	total_input.value =
		parseInt(upper_sum_input.value) +
		parseInt(lower_sum_input.value) +
		parseInt(bonus_input.value);
}

function update_die_elements(roll)
{
	roll.forEach((die_value, index) => {
		var die_element = document.getElementById('die' + (index + 1));
		if (is_die_held[index + 1]) {
			die_element.innerHTML = '<strong>' + dice.faces[die_value]; + '</strong>';
		} else {
			die_element.innerHTML = dice.faces[die_value];
		}
	});
}

function on_click_die(die_index)
{
	is_die_held[die_index] = !is_die_held[die_index];
	update_die_elements(most_recent_roll);
}

function on_click_roll()
{
	const dice_count = 5;
	var new_roll = dice.roll_d6(dice_count);
	console.log(dice.to_string(new_roll));

	most_recent_roll = new_roll.map((value, index) => {
		return is_die_held[index + 1] ? most_recent_roll[index] : value;
	});

	update_die_elements(most_recent_roll);
}

function on_click_scorecard_input(element_id)
{
	var element = document.getElementById(element_id);
	var score = scorecard_evals[element_id](most_recent_roll);
	element.value = score;
}

function on_change_scorecard()
{
	update_scorecard_totals();
}

window.onload = function()
{
	update_scorecard_totals();
	on_click_roll();
}

</script>

<h1>Yatzy</h1>

<p><a href="https://en.wikipedia.org/wiki/Yatzy">Rules</a></p>

<h2>Dice</h2>

<p>Click to hold a die</p>

<table>
<tr>
	<td><div id="die1" class="dice" onclick="on_click_die(1)"></div></td>
	<td><div id="die2" class="dice" onclick="on_click_die(2)"></div></td>
	<td><div id="die3" class="dice" onclick="on_click_die(3)"></div></td>
	<td><div id="die4" class="dice" onclick="on_click_die(4)"></div></td>
	<td><div id="die5" class="dice" onclick="on_click_die(5)"></div></td>
</tr>
</table>

<button onclick="on_click_roll();">Roll</button>

<h2>Scorecard</h2>

<table>
<tr>
	<td><strong>Upper Section</strong></td>
</tr>
<tr>
	<td><p>Ones</p></td>
	<td><input type="text"
		id="yatzy_scorecard_ones"
		onclick="on_click_scorecard_input('yatzy_scorecard_ones')"
		onchange="on_change_scorecard()"></td>
	<td><p class="score_help">Sum of all 1s</p>
</tr>
<tr>
	<td><p>Twos</p></td>
	<td><input type="text"
		id="yatzy_scorecard_twos"
		onclick="on_click_scorecard_input('yatzy_scorecard_twos')"
		onchange="on_change_scorecard()"></td>
	<td><p class="score_help">Sum of all 2s</p>
</tr>
<tr>
	<td><p>Threes</p></td>
	<td><input type="text"
		id="yatzy_scorecard_threes"
		onclick="on_click_scorecard_input('yatzy_scorecard_threes')"
		onchange="on_change_scorecard()"></td>
	<td><p class="score_help">Sum of all 3s</p>
</tr>
<tr>
	<td><p>Fours</p></td>
	<td><input type="text"
		id="yatzy_scorecard_fours"
		onclick="on_click_scorecard_input('yatzy_scorecard_fours')"
		onchange="on_change_scorecard()"></td>
	<td><p class="score_help">Sum of all 4s</p>
</tr>
<tr>
	<td><p>Fives</p></td>
	<td><input type="text"
		id="yatzy_scorecard_fives"
		onclick="on_click_scorecard_input('yatzy_scorecard_fives')"
		onchange="on_change_scorecard()"></td>
	<td><p class="score_help">Sum of all 5s</p>
</tr>
<tr>
	<td><p>Sixes</p></td>
	<td><input type="text"
		id="yatzy_scorecard_sixes"
		onclick="on_click_scorecard_input('yatzy_scorecard_sixes')"
		onchange="on_change_scorecard()"></td>
	<td><p class="score_help">Sum of all 6s</p>
</tr>
<tr>
	<td><strong>Lower Section</strong></td>
</tr>
<tr>
	<td><p>One Pair</p></td>
	<td><input type="text"
		id="yatzy_scorecard_one_pair"
		onclick="on_click_scorecard_input('yatzy_scorecard_one_pair')"
		onchange="on_change_scorecard()"></td>
	<td><p class="score_help">Sum of the pair</td>
</tr>
<tr>
	<td><p>Two Pair</p></td>
	<td><input type="text"
		id="yatzy_scorecard_two_pair"
		onclick="on_click_scorecard_input('yatzy_scorecard_two_pair')"
		onchange="on_change_scorecard()"></td>
	<td><p class="score_help">Sum of the pairs</td>
</tr>
<tr>
	<td><p>Three of a Kind</p></td>
	<td><input type="text"
		id="yatzy_scorecard_three_of_a_kind"
		onclick="on_click_scorecard_input('yatzy_scorecard_three_of_a_kind')"
		onchange="on_change_scorecard()"></td>
	<td><p class="score_help">Sum of the three dice</td>
</tr>
<tr>
	<td><p>Four of a Kind</p></td>
	<td><input type="text"
		id="yatzy_scorecard_four_of_a_kind"
		onclick="on_click_scorecard_input('yatzy_scorecard_four_of_a_kind')"
		onchange="on_change_scorecard()"></td>
	<td><p class="score_help">Sum of the four dice</td>
</tr>
<tr>
	<td><p>Small Straight</p></td>
	<td><input type="text"
		id="yatzy_scorecard_small_straight"
		onclick="on_click_scorecard_input('yatzy_scorecard_small_straight')"
		onchange="on_change_scorecard()"></td>
	<td><p class="score_help">30 points</td>
</tr>
<tr>
	<td><p>Large Straight</p></td>
	<td><input type="text"
		id="yatzy_scorecard_large_straight"
		onclick="on_click_scorecard_input('yatzy_scorecard_large_straight')"
		onchange="on_change_scorecard()"></td>
	<td><p class="score_help">30 points</td>
</tr>
<tr>
	<td><p>Full House</p></td>
	<td><input type="text"
		id="yatzy_scorecard_full_house"
		onclick="on_click_scorecard_input('yatzy_scorecard_full_house')"
		onchange="on_change_scorecard()"></td>
	<td><p class="score_help">Sum of all dice</p></td>
</tr>
<tr>
	<td><p>Chance</p></td>
	<td><input type="text"
		id="yatzy_scorecard_chance"
		onclick="on_click_scorecard_input('yatzy_scorecard_chance')"
		onchange="on_change_scorecard()"></td>
	<td><p class="score_help">Sum of all dice</p></td>
</tr>
<tr>
	<td><p>Yatzy</p></td>
	<td><input type="text"
		id="yatzy_scorecard_yatzy"
		onclick="on_click_scorecard_input('yatzy_scorecard_yatzy')"
		onchange="on_change_scorecard()"></td>
	<td><p class="score_help">50 points</p></td>
</tr>
<tr>
	<td><strong>Total</strong></td>
</tr>
<tr>
	<td><p>Upper Sum</p></td>
	<td><input type="text"
		id="yatzy_scorecard_upper_sum"
		readonly></td>
</tr>
<tr>
	<td><p>Bonus</p></td>
	<td><input type="text"
		id="yatzy_scorecard_bonus"
		readonly></td>
</tr>
<tr>
	<td><p>Lower Sum</p></td>
	<td><input type="text"
		id="yatzy_scorecard_lower_sum"
		readonly></td>
</tr>
<tr>
	<td><p>Total</p></td>
	<td><input type="text"
		id="yatzy_scorecard_total"
		readonly></td>
</tr>
</table>

</body>
</html>
